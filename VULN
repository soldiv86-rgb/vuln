-- FIXED Pet-Triggered Auto Carrot Favoriter (No more errors!)
-- Optimized hook: NO recursion, NO lag, NO interference with GameAnalytics or other scripts
-- Starts on EquipPet UUID, Stops on UnequipPet UUID

local RS = game:GetService("ReplicatedStorage")
local GameEvents = RS:WaitForChild("GameEvents")
local PetsService = GameEvents:WaitForChild("PetsService")
local Favorite_Item = GameEvents:WaitForChild("Favorite_Item")

local mt = getrawmetatable(game)
local old_namecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    
    -- Early exit for NON-FireServer (99% of calls)
    if method ~= "FireServer" then
        return old_namecall(self, ...)
    end
    
    -- Early exit for non-RemoteEvents & non-PetsService (super safe & fast)
    if self.ClassName ~= "RemoteEvent" or self ~= PetsService then
        return old_namecall(self, ...)
    end
    
    local args = {...}
    if typeof(args[1]) ~= "string" then
        return old_namecall(self, ...)
    end
    
    if args[1] == "EquipPet" and args[2] == "{9c8926b2-0362-4019-85e7-905ea7a8433a}" then
        _G.auto = true
        print("ðŸŸ¢ Auto Carrot Favoriter STARTED! (Pet equipped)")
        
    elseif args[1] == "UnequipPet" and args[2] == "{9c8926b2-0362-4019-85e7-905ea7a8433a}" then
        _G.auto = false
        print("ðŸ”´ Auto Carrot Favoriter STOPPED! (Pet unequipped)")
    end
    
    return old_namecall(self, ...)
end)

setreadonly(mt, true)

-- Safe auto loop (pcall wrapped, no re-entrancy issues)
task.spawn(function()
    while true do
        if _G.auto then
            local success, carrot = pcall(function()
                local player = game.Players.LocalPlayer
                return player.Backpack:FindFirstChild("Carrot [0.38kg]") 
                    or (player.Character and player.Character:FindFirstChild("Carrot [0.38kg]"))
            end)
            
            if success and carrot then
                pcall(function()
                    Favorite_Item:FireServer(carrot)
                end)
            end
        end
        task.wait(0.2)
    end
end)

print("âœ… FIXED Pet-Triggered Auto Carrot Favoriter LOADED! (0.2s loop)")
print("ðŸ’¡ NO MORE ERRORS! Hook is optimized & safe.")
print("ðŸ’¡ Equip pet {9c8926b2-0362-4019-85e7-905ea7a8433a} to START | Unequip to STOP")
print("ðŸ’¡ Works with GUI/scripts. Re-execute if rejoin.")
