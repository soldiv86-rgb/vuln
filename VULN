-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
--   FRUIT LOOP FUNCTIONS
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function startFruitLoop()
    if _G.loopFav then return end -- prevent multiple loops
    _G.loopFav = true

    task.spawn(function()
        while _G.loopFav do
            local fruitName = "Carrot [0.38kg]"
            local player = game:GetService("Players").LocalPlayer
            local fruit = player.Backpack:FindFirstChild(fruitName)

            if fruit then
                game:GetService("ReplicatedStorage").GameEvents.Favorite_Item:FireServer(fruit)
            end

            task.wait(1)
        end
    end)

    print("ğŸ”¥ Fruit loop started")
end

local function stopFruitLoop()
    if _G.loopFav then
        _G.loopFav = false
        print("ğŸ›‘ Fruit loop stopped")
    end
end


-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
--   DETECT START / STOP PET EVENTS
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local PetsService = game:GetService("ReplicatedStorage").GameEvents.PetsService
local petUUID = "{9c8926b2-0362-4019-85e7-905ea7a8433a}"


-- Hook FireServer to detect outgoing Equip/Unequip events
local old; old = hookmetamethod(game, "__namecall", function(self, ...)
    local args = {...}

    if self == PetsService and getnamecallmethod() == "FireServer" then
        
        -- â­ START when EquipPet is fired
        if args[1] == "EquipPet" and tostring(args[2]) == petUUID then
            print("EquipPet detected â†’ starting loop")
            startFruitLoop()
        end
        
        -- â­ STOP when UnequipPet is fired
        if args[1] == "UnequipPet" and tostring(args[2]) == petUUID then
            print("UnequipPet detected â†’ stopping loop")
            stopFruitLoop()
        end

    end

    return old(self, ...)
end)
